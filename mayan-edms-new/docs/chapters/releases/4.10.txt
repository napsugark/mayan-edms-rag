Version 4.10
============

Released: October 30, 2025

Summary
-------

This release very comprehensive, featuring broad architectural refinements,
major dependency upgrades, and enhancements to developer tooling,
UI consistency, and security.

Key highlights include:

- Migration to PostgreSQL 15
- Support for Elasticsearch 9
- Deprecation of Oracle database support
- Addition of API throttling
- Many dependency updates
- Docker image updates
- Workflow instance sandboxing
- OpenAI/ChatGPT-based document file visual and text processing
- Documentation reorganization for clarity and maintainability
- Modernization of internal apps, templates, and developer tooling
- Compliance improvements with PEP 639 SPDX licensing

This release emphasizes modernization, modularization, and consistency
across all layers of Mayan EDMS.


Changes
-------

Backward incompatible changes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- Users must backup and convert their PostgreSQL data files to version 15.
  The steps to perform these tasks are outlined in the following Knowledge
  Base articles (subscription required):

  - `Backing up a Mayan EDMS Docker Compose stack PostgreSQL service <https://forum.mayan-edms.com/t/backing-up-a-mayan-edms-docker-compose-stack-postgresql-service/2184>`_
  - `Convert the PostgreSQL database data files version using Docker Compose <https://forum.mayan-edms.com/t/convert-the-postgresql-database-data-files-version-using-docker-compose/2186>`_

- Renamed command `platform_template` to `platforms_template`.
- Setting `PLATFORM_CLIENT_BACKEND_ENABLED` was renamed to
  `PLATFORMS_CLIENT_BACKEND_ENABLED`.
- Setting `PLATFORM_CLIENT_BACKEND_ARGUMENTS` was renamed to
  `PLATFORMS_CLIENT_BACKEND_ARGUMENTS`.
- Renamed the Elasticsearch backend from `ElasticSearchBackend` to
  `ElasticsearchSearchBackend` for consistency.


Deprecations
^^^^^^^^^^^^

- The Portainer installation files will be removed in the next minor release.
  These files were initially community-submitted, but community interest in
  ongoing maintenance has diminished.
- The ORACLE database support is deprecated and will be removed in the
  next minor version.


Database & Search
^^^^^^^^^^^^^^^^^

- Updated PostgreSQL to version 15 and changed the base image from Alpine to
  the default Debian-based image.
- Updated PostgreSQL Docker tag from 14.15-alpine3.21 to 15.11.
- Added support for Elasticsearch 9:

  - Elasticsearch backend renamed to `ElasticsearchSearchBackend`.
  - All Elasticsearch client arguments are now passed through `client_kwargs`.
  - New arguments:

    - `search_page_size`: sets the default page size.
    - `point_in_time_keep_alive`: defines the keep-alive duration for PIT queries.

  - Default Docker Compose now runs Elasticsearch over HTTPS.
  - Renamed make targets for consistency:

    - `docker-elastic-start` to `docker-elasticsearch-start`
    - `docker-elastic-stop` to `docker-elasticsearch-stop`

  - Improved database access performance: optimized document object managers
    to reduce the likelihood of N+1 queries.
  - Added method `get_databases_sqlite` for consistent SQLite configuration
    generation.
  - Deprecated Oracle support; related files will be removed in the next
    minor version.


Application Architecture
^^^^^^^^^^^^^^^^^^^^^^^^

- Added workflow instance sandboxes for better workflow execution debugging.
- Added support for deleting multiple transformations via the UI.
- Added support for deleting workflow instances via both the UI and API.
- Introduced OpenAI-based file metadata driver.
- Added document file content as a model attribute for document file
  automation, sandboxes, and templates.
- Refactored file metadata processing with a new `do_document_file_process`
  method to consolidate subclass logic.
- Moved the Google credentials backend to its own dedicated app.
- Moved the Sentry API client to its own app named `platforms_sentry`.
- Exposed Django's `CACHES` setting as `MAYAN_CACHES`.
- Added API throttling with default limits:

  - Anonymous users: 5 requests per second.
  - Authenticated users: 10 requests per second.


UI / UX
^^^^^^^

- Removed deprecated user theme support.
- Changed the default message position from `top-right` to `bottom-right`.
- Updated the statistics view icon to use a facet link.
- Fixed the label of the index template return link.
- Renamed link "Setup parsing" to "Parsing setup" for better visual scan.
- Renamed duplicated document links and view titles for clarity.
- Updated workflow template transition trigger widget to use a
  `SourceColumnWidget` subclass.
- Added help text to the `OCR_BACKEND_ARGUMENTS` setting.
- Improved form-related logic:

  - Enhanced form fieldset mismatch exception messages.
  - Added `FormMixinFormMeta` and made `FormMixinFieldsets` subclass it.
  - Added support for specifying custom form options via the new `FormMeta`
    class.
  - Updated `FormFieldMixinFilteredQueryset` to use `source_queryset`.
- Added a new template filter: `yaml_dump`, which outputs data in YAML
  format.
- Introduced the ability to mark template tags and filters as "dangerous",
  controlled by the setting `TEMPLATING_TAGS_DANGEROUS_ALLOW_LIST`.
- Changed how template tags and filters are named-functions are now prefixed
  with `tag_` and `filter_`.
- Improved password reset handling:

  - Redirects users away from password reset views when reset is disabled.
  - Split authentication and password reset views into separate modules.

- Updated the workflow HTTP action to allow bypassing SSL verification for
  internal or self-signed intranet endpoints.


Developer & Build System
^^^^^^^^^^^^^^^^^^^^^^^^

- Removed Keycloak settings and Docker Compose templates.
- Removed Django Admin and Sites apps to streamline dependencies.
- Renamed the `platform` app to `platforms` for consistency.
- Renamed management command `platform_template` to `platforms_template`.
- Added `pkg-config` as a build-time dependency.
- Split the Docker Compose installation documentation into multiple files for
  better readability.
- Added `config-env-copy` target (renamed from `copy-config-env`).
- Split `DOCKER_LINUX_IMAGE_VERSION` into `DOCKER_LINUX_IMAGE_NAME` and
  `DOCKER_LINUX_IMAGE_TAG`.
- Split `DOCKER_MYSQL_IMAGE_VERSION` into `DOCKER_MYSQL_IMAGE_NAME` and
  `DOCKER_MYSQL_IMAGE_TAG`.
- Added automation for copyright year updates.
- Refactored `generate_setup.py`.
- Renamed GitLab CI variables and conventions:

  - Prefix all branches with `ci`.
  - `GIT_REMOTE_NAME` renamed to `GITLAB_CI_REMOTE_NAME`.
  - `GITLAB_CI_BRANCH_TRY_STAGING` passed dynamically rather than hardcoded.

- Added support for retrieving the `psutil` version from the `config.env` file.
- Introduced partial app template loading for the "About" view.


Dependency & Library Management
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
- Removed unused dependencies:

  - django-mathfilters
  - selenium
  - coveralls
  - safety
  - importlib-metadata

- Updated dependency versions:

  - Django: 4.2.18 to 4.2.20
  - Jinja2: 3.1.4 to 3.1.5
  - boto3: 1.35.85 to 1.37.22
  - Pillow: 11.0.0 to 11.1.0
  - Sphinx: 8.1.3 to 8.2.3
  - google-cloud-storage: 2.19.0 to 3.1.0
  - and many others (full list included in the changelog).

- Removed Jinja2 from the core dependencies; version is now managed via Sphinx.
- Updated messaging app to replace Bleach with NH3 for HTML sanitization.
- Moved NH3 dependency to the common app.


Docker & CI/CD
^^^^^^^^^^^^^^

- Updated Docker images:

  - PostgreSQL: 14.15-alpine3.21 to 15.11
  - Debian: 12.8-slim to 12.9-slim
  - Redis: 7.4.1-alpine3.20 to 7.4.2
  - RabbitMQ: 4.0.5-management-alpine to 4.0.6-management
  - Traefik: 2.11.16 to 2.11.20
  - MySQL to replaced with MariaDB 11.7.2
  - GitLab CI runner: 27.4.1-dind-alpine3.21 to 27.5.1-dind-alpine3.21

- Updated Docker Compose volume names and documentation references.


Documentation
^^^^^^^^^^^^^

- Complete reorganization of documentation structure:

  - Removed `parts/` directories.
  - All content is now organized in chapters.
  - Deprecations, removals, and backward-incompatible changes are documented
    in the first release of each series.

- Renamed scripts and makefile targets to follow the `{object}-{verb}` format.
- Fixed various Sphinx warnings and improved build stability.
- Updated Docker Compose examples and installation documentation.
- Improved clarity around deprecated settings and removed features.


Compliance & Licensing
^^^^^^^^^^^^^^^^^^^^^^

- Added SPDX license expression to comply with PEP 639.
- Ensured packaging metadata follows PEP-compliant distribution standards.


Language & Localization
^^^^^^^^^^^^^^^^^^^^^^^

- Added new translation languages and variants:

  - Bulgarian (Bulgaria)
  - German (Germany)
  - Greek (Greece)
  - Spanish (Spain)
  - Japanese
  - Russian (Russia)
  - Ukrainian (Ukraine)

- Updated translation system to include all JavaScript files.


Performance & Optimization
^^^^^^^^^^^^^^^^^^^^^^^^^^

- Optimized document managers to reduce N+1 queries.
- Improved overall query efficiency in core models and workflows.
- Reduced PyPI metadata size by no longer appending the changelog to the package description.


Governance & Branding
^^^^^^^^^^^^^^^^^^^^^

- Removed donation links; the project no longer accepts donations.
- Updated all branding references, logos, and documentation consistency.


Removed or Deprecated Features
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- Removed user theme support.
- Removed Keycloak Docker Compose files.
- Removed Django Admin and Sites apps.
- Deprecated Oracle database support (removal in next minor version).
- Removed old date parsing filter `{{ |date_parse }}`, replaced by `{% date_parse %}` tag.
- Removed `COMMON_COLLAPSE_LIST_MENU_OBJECT` and
  `COMMON_COLLAPSE_LIST_MENU_LIST_FACET` settings. Their behavior is now fixed to `True`.
- Removed legacy files and obsolete code (`removals.txt`, `ModelFormFieldFilteredModelChoice`).
- Removed `elasticsearch-dsl` library. Its functionality is now merged into
  `elasticsearch`.
- The `safety` Python package and its related makefile targets.
- Remove `importlib-metadata`
